<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>Workshop Ministério Infantil 2023</title>
  </head>
  <body>
    <div class="container my-5">        
      <h1>Workshop Ministério Infantil 2023</h1>
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Pergunta</th>
            <th scope="col">Ações</th>
          </tr>
        </thead>
        <tbody id="tbody-perguntas">          
        </tbody>
      </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        
        var perguntas = [];

        var myHeaders = new Headers();
        myHeaders.append("X-Master-Key", "$2b$10$wsWfBEOc1scRz1w70BusTOwnRqEkhaO2Sj2UPaDpKPyp.ElnbxauO");
        myHeaders.append("Content-Type", "application/json");

        setInterval(() => {
            
            var requestOptions = {
            method: 'GET',
            headers: myHeaders,        
            redirect: 'follow'
            };

            fetch("https://api.jsonbin.io/v3/b/645e6b52b89b1e22999c62cb", requestOptions)
            .then(response => response.text())
            .then(result => {

                var htmlperguntas = '';
                var o = JSON.parse(result);
                perguntas = o.record;

                for (let index = 0; index < o.record.length; index++) {
                    const element = o.record[index];
                    
                    if (!element.avaliada) {
                        htmlperguntas += `
                        <tr id="`+element.id+`">
                            <td>`+ element.pergunta +`</td>   
                            <td>
                                <button type="button" class="btn btn-success" onclick="aprovar('`+element.id+`')">Enviar</button>
                                <button type="button" class="btn btn-danger" onclick="recusar('`+element.id+`')">Recusar</button>
                            </td>         
                        </tr>`;
                    }
                }

                document.getElementById('tbody-perguntas').innerHTML = htmlperguntas;
            })
            .catch(error => console.log('error', error));
        }, 15000);
      
        function aprovar(idpergunta) {
            
            for (let index = 0; index < perguntas.length; index++) {

                if (perguntas[index].id == idpergunta) {
                    perguntas[index].aprovada = true;
                    perguntas[index].avaliada = true;
                }
            }

            var raw = JSON.stringify(perguntas);
            var requestOptions = {
            method: 'PUT',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
            };

            fetch("https://api.jsonbin.io/v3/b/645e6b52b89b1e22999c62cb", requestOptions)
            .then(response => response.text())
            .then(result => {
                document.getElementById(idpergunta).style.display = 'none';
            })
            .catch(error => {
            console.log(error);
            });

        }

        function recusar(idpergunta) {
            
            for (let index = 0; index < perguntas.length; index++) {

                if (perguntas[index].id == idpergunta) {
                    perguntas[index].aprovada = false;
                    perguntas[index].avaliada = true;
                }
            }

            var raw = JSON.stringify(perguntas);
            var requestOptions = {
            method: 'PUT',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
            };

            fetch("https://api.jsonbin.io/v3/b/645e6b52b89b1e22999c62cb", requestOptions)
            .then(response => response.text())
            .then(result => {
                document.getElementById(idpergunta).style.display = 'none';
            })
            .catch(error => {
                console.log(error);
            });
        }

    </script>
  </body>
</html>














