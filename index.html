<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>Workshop Ministério Infantil 2023</title>
  </head>
  <body>
    <div class="container my-5">
        <h5 id="h5-bem-vindo">Bem vindo ao</h5>
      <h1>Workshop Ministério Infantil 2023</h1>
      
        <div id="principal" style="display: none;">
            <div class="mb-3">
                <label for="pergunta" class="form-label">Mande sua dúvida ou pergunta:</label>
                <textarea class="form-control" id="pergunta" name="pergunta" required></textarea>
              </div>       
              <button id="btn-salvar" class="btn btn-primary" onclick="salvar()">Enviar</button>
              <div id="alert-success" class="alert alert-success alert-dismissable" style="display: none;">
                  <h4>
                      Ok!
                  </h4> 
                  Enviada com sucesso!
              </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        var perguntas = [];
        var myHeaders = new Headers();
        myHeaders.append("X-Master-Key", "$2b$10$wsWfBEOc1scRz1w70BusTOwnRqEkhaO2Sj2UPaDpKPyp.ElnbxauO");
        myHeaders.append("Content-Type", "application/json");

        var requestOptions = {
        method: 'GET',
        headers: myHeaders,        
        redirect: 'follow'
        };

        fetch("https://api.jsonbin.io/v3/b/645e6b52b89b1e22999c62cb", requestOptions)
        .then(response => response.text())
        .then(result => {

            var o = JSON.parse(result);
            for (let index = 0; index < o.record.length; index++) {
                const element = o.record[index];
                perguntas.push(element);
            }

            document.getElementById('principal').style.display = 'block';
            document.getElementById('h5-bem-vindo').style.display = 'none';
        })
        .catch(error => console.log('error', error));

        function salvar() {
            
            document.getElementById('btn-salvar').style.display = 'none';

            var item = {
                "id": perguntas.length + 1,
                "pergunta": document.getElementById('pergunta').value,
                "avaliada": false,
                "aprovada": false
            };

            perguntas.push(item);
            
            var raw = JSON.stringify(perguntas);
            var requestOptions = {
            method: 'PUT',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
            };

            fetch("https://api.jsonbin.io/v3/b/645e6b52b89b1e22999c62cb", requestOptions)
            .then(response => response.text())
            .then(result => {

                console.log(result);
                document.getElementById('alert-success').style.display = 'block';
                
                setTimeout(() => {
                    document.getElementById('alert-success').style.display = 'none';
                    document.getElementById('btn-salvar').style.display = 'block';
                    document.getElementById('pergunta').value = '';
                    

                }, 5000);

            })
            .catch(error => {
                document.getElementById('btn-salvar').style.display = 'block';
            });
        }
    </script>
  </body>
</html>
